(function(){"use strict";var e={8957:function(e,t,i){var r=i(5130),n=i(6768);const o={class:"menuEditor__navWrapper"},s=(0,n.Lk)("button",null,"Меню",-1),a=(0,n.Lk)("button",null,"Авторизация",-1),l={style:{"margin-top":"75px"}};function u(e,t,i,r,u,c){const d=(0,n.g2)("RouterLink"),h=(0,n.g2)("RouterView");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("div",o,[(0,n.bF)(d,{to:"/menu"},{default:(0,n.k6)((()=>[s])),_:1}),e.isAuthenticated?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(d,{key:0,to:"/login"},{default:(0,n.k6)((()=>[a])),_:1})),e.isAuthenticated?((0,n.uX)(),(0,n.Wv)(d,{key:1,to:"/home"},{default:(0,n.k6)((()=>[(0,n.Lk)("button",{onClick:t[0]||(t[0]=e=>c.logout())},"Выйти")])),_:1})):(0,n.Q3)("",!0)]),(0,n.Lk)("div",l,[(0,n.bF)(h)])],64)}i(4114);var c=i(1387),d=i(782),h={components:{RouterLink:c.Wk,RouterView:c.Tp},computed:{...(0,d.aH)(["isAuthenticated","role"])},methods:{...(0,d.i0)(["setAuthenticated","setRole"]),logout(){const e={method:"GET",headers:{"Content-Type":"application/json"}};fetch("http://localhost:3000/logout",e).then((e=>e.headers.get("Content-Type")?.includes("application/json")?e.json():e.text())).then((()=>{this.setAuthenticated(!1),this.setRole(null),this.$router.push("/MenuEditor")}))}}},m=i(1241);const p=(0,m.A)(h,[["render",u]]);var b=p,g=i(4232);const v={class:"menuEditor"},f={key:0,class:"sectionMenu"},E=(0,n.Lk)("h2",null,"Редактор меню",-1),k=["placeholder"];function _(e,t,i,o,s,a){const l=(0,n.g2)("recursive-menu-item"),u=(0,n.g2)("BreadcrumbsComponent");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("section",v,[(0,n.bF)(r.F,{name:"slide-fade",tag:"ul",class:(0,g.C4)(["menuEditor__wrapper",{"menuEditor__wrapper--forUser":"admin"!==e.role}])},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.menuTree,(t=>((0,n.uX)(),(0,n.Wv)(l,{key:t.id,item:t,role:e.role,"breadcrumb-path":s.breadcrumbPath,onToggleActive:a.toggleActive,onEditItem:a.editMenuItem,onDeleteItem:a.deleteMenuItem,onAddMenuItem:a.addMenuItem,onClickBreadcrumb:a.updateBreadcrumb},null,8,["item","role","breadcrumb-path","onToggleActive","onEditItem","onDeleteItem","onAddMenuItem","onClickBreadcrumb"])))),128))])),_:1},8,["class"]),(0,n.bF)(u,{"breadcrumb-path":s.breadcrumbPath},null,8,["breadcrumb-path"])]),"admin"===e.role?((0,n.uX)(),(0,n.CE)("div",f,[E,(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>s.newName=e),placeholder:s.newPlaceholderParent},null,8,k),[[r.Jo,s.newName]]),(0,n.Lk)("button",{onClick:t[1]||(t[1]=e=>a.addMenuItem())},"Добавить"),(0,n.Lk)("button",{onClick:t[2]||(t[2]=e=>a.saveMenu())},"Сохранить изменения")])):(0,n.Q3)("",!0)],64)}const A={class:"menuEditor__wrapper_items-item--main"},C={class:"menuEditor__wrapper_items-item--mainSubMain"},w={key:0,class:"menuEditor__wrapper_items-item--submain"};function I(e,t,i,r,o,s){const a=(0,n.g2)("router-link"),l=(0,n.g2)("recursive-menu-item",!0);return(0,n.uX)(),(0,n.CE)("li",{class:"menuEditor__wrapper_items-item",onMouseenter:t[7]||(t[7]=e=>s.emitToggleActive(!0)),onMouseleave:t[8]||(t[8]=e=>s.emitToggleActive(!1))},[(0,n.Lk)("div",A,[(0,n.Lk)("div",C,["admin"===i.role?((0,n.uX)(),(0,n.CE)("button",{key:0,class:"change",onClick:t[0]||(t[0]=(...e)=>s.emitEditMenuItem&&s.emitEditMenuItem(...e))},"Edit")):(0,n.Q3)("",!0),"admin"===i.role?((0,n.uX)(),(0,n.CE)("button",{key:1,class:"buttonChild",onClick:t[1]||(t[1]=(...e)=>s.emitAddMenuItem&&s.emitAddMenuItem(...e))},"+")):(0,n.Q3)("",!0)]),(0,n.bF)(a,{to:"/"},{default:(0,n.k6)((()=>[(0,n.Lk)("button",null,(0,g.v_)(i.item.title),1)])),_:1}),"admin"===i.role?((0,n.uX)(),(0,n.CE)("button",{key:0,class:"close",onClick:t[2]||(t[2]=(...e)=>s.emitDeleteMenuItem&&s.emitDeleteMenuItem(...e))},"X")):(0,n.Q3)("",!0)]),i.item.isActive&&i.item.child?((0,n.uX)(),(0,n.CE)("ul",w,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.item.child,(r=>((0,n.uX)(),(0,n.Wv)(l,{key:r.id,item:r,role:i.role,onToggleActive:t[3]||(t[3]=t=>e.$emit("toggle-active",t)),onEditItem:t[4]||(t[4]=t=>e.$emit("edit-item",t)),onDeleteItem:t[5]||(t[5]=t=>e.$emit("delete-item",t)),onAddMenuItem:t[6]||(t[6]=t=>e.$emit("add-menu-item",t)),onClickBreadcrumb:e=>s.handleClick(r)},null,8,["item","role","onClickBreadcrumb"])))),128))])):(0,n.Q3)("",!0)],32)}var T={name:"RecursiveMenuItem",props:{item:{type:Object,required:!0},role:String,breadcrumbPath:Array},methods:{handleClick(e){const t=this.getBreadcrumbPath(e);this.$emit("click-breadcrumb",t)},getBreadcrumbPath(e){let t=[];return e.parent&&null!==e.parentId&&(t=this.getBreadcrumbPath(e.parent)),t.push(e.title),t},emitToggleActive(e){this.$emit("toggle-active",this.item.id,e)},emitEditMenuItem(){this.$emit("edit-item",this.item.id)},emitDeleteMenuItem(){this.$emit("delete-item",this.item.id)},emitAddMenuItem(){this.$emit("add-menu-item",this.item.id)}}};const y=(0,m.A)(T,[["render",I]]);var P=y;const L={class:"breadcrumbs"},R={key:0};function M(e,t,i,r,o,s){return(0,n.uX)(),(0,n.CE)("nav",null,[(0,n.Lk)("ul",L,[i.breadcrumbPath.length>0?((0,n.uX)(),(0,n.CE)("li",R,[(0,n.Lk)("span",null,(0,g.v_)(s.breadcrumbLabels),1)])):(0,n.Q3)("",!0)])])}var S={props:{breadcrumbPath:{type:Array,required:!0}},computed:{breadcrumbLabels(){return this.breadcrumbPath.join(" / ")}}};const X=(0,m.A)(S,[["render",M],["__scopeId","data-v-8796ed82"]]);var F=X,$={data(){return{newName:"",newUnderName:"",newPlaceholderParent:"Название меню",activeItemId:null,breadcrumbPath:[],menuTree:[]}},components:{BreadcrumbsComponent:F,RecursiveMenuItem:P},computed:{...(0,d.aH)({isAuthenticated:e=>e.isAuthenticated,role:e=>e.isRole})},methods:{...(0,d.i0)(["setAuthenticated","setRole"]),loadMenu(){const e={method:"GET",headers:{"Content-Type":"application/json"}};fetch("http://localhost:3000/apiMenu/menu_items",e).then((e=>e.json())).then((e=>{this.menuTree=e.menu})).catch((e=>console.error("Ошибка загрузки меню:",e)))},toggleInput(e){const t=e.target,i=e=>t.classList.contains(e),r=t.closest(".menuEditor"),n=r?.querySelector(".sectionGap__parent_child .change");if(i("change")||i("buttonChild")){const e=r?.querySelectorAll("input");if(e&&e.length>1){const t=n||i("buttonChild")?e[1]:e[0];t.focus()}}},toggleActive(e){this.updateBreadcrumb(this.menuTree,e),this.resetActiveState(this.menuTree,e),this.updateActiveState(this.menuTree,e),this.buildTree()},resetActiveState(e,t){e.forEach((e=>{e.id===t||e.child&&this.containsActiveChild(e.child,t)||(e.isActive=!1),e.child&&this.resetActiveState(e.child,t)}))},containsActiveChild(e,t){return e.some((e=>e.id===t||e.child&&this.containsActiveChild(e.child,t)))},updateActiveState(e,t){e.forEach((e=>{e.id===t&&(e.isActive=!e.isActive),e.child&&this.updateActiveState(e.child,t)}))},addMenuItem(e=null){const t={id:Date.now(),title:this.newName,isActive:!1,parentId:e,child:[]};null===e?this.menuTree.push(t):this.menuTree=this.addToParent(this.menuTree,e,t),this.buildTree()},addToParent(e,t,i){return e.map((e=>(e.id===t?(Array.isArray(e.child)||(e.child=[]),e.child.push(i)):e.child&&(e.child=this.addToParent(e.child,t,i)),e)))},editMenuItem(e){this.menuTree=this.updateItem(this.menuTree,e,(e=>{e.title=this.newName})),this.buildTree()},updateItem(e,t,i){return e.map((e=>(e.id===t?i(e):e.child&&(e.child=this.updateItem(e.child,t,i)),e)))},buildTree(){const e=[],t={};this.menuTree.forEach((i=>{const{parentId:r}=i;r?(t[r]||(t[r]=[]),t[r].push(i)):e.push(i)}));const i=e=>{e.forEach((e=>{t[e.id]&&(e.child=t[e.id],i(e.child))}))};i(e),this.menuTree=e},deleteItemFromMenu(e,t){return e.reduce(((e,i)=>(i.id===t||(i.child&&(i.child=this.deleteItemFromMenu(i.child,t)),e.push(i)),e)),[])},deleteMenuItem(e){this.menuTree=this.deleteItemFromMenu(this.menuTree,e),this.buildTree()},saveMenu(){const e=t=>t.map((t=>{const{id:i,title:r,isActive:n,child:o}=t;return{id:i,title:r,isActive:n,child:o?e(t.child):[]}})),t=e(this.menuTree),i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({menu:t})};fetch("http://localhost:3000/apiMenu/menu_items/save",i).then((e=>e.json())).then((e=>console.log("Menu saved:",e))).catch((e=>console.error("Error saving menu:",e)))},updateBreadcrumb(e,t){this.breadcrumbPath=[],this.findBreadcrumbPath(e,t)},findBreadcrumbPath(e,t){for(const i of e){if(i.id===t)return this.breadcrumbPath.push(i.title),!0;if(i.child&&this.findBreadcrumbPath(i.child,t))return this.breadcrumbPath.unshift(i.title),!0}return!1}},mounted(){this.loadMenu(),this.buildTree(),window.addEventListener("click",this.handleClickOutside),window.addEventListener("click",this.toggleInput)}};const j=(0,m.A)($,[["render",_]]);var O=j,D={__name:"MenuDisplayView",setup(e){return(e,t)=>((0,n.uX)(),(0,n.CE)("main",null,[(0,n.bF)(O)]))}};const B=D;var x=B;const N={key:0},Q=["placeholder"],V=["placeholder"],U=["placeholder"],J=["placeholder"],W={type:"submit",class:"authorization_button"};function q(e,t,i,o,s,a){return(0,n.uX)(),(0,n.CE)("section",null,[(0,n.Lk)("h2",null,(0,g.v_)(s.isRegister?"Регистрация":"Авторизация"),1),s.fetchDataResponse?((0,n.uX)(),(0,n.CE)("h3",N,(0,g.v_)(s.DataResponseText),1)):(0,n.Q3)("",!0),(0,n.Lk)("form",{onSubmit:t[5]||(t[5]=(0,r.D$)(((...e)=>a.handleSubmit&&a.handleSubmit(...e)),["prevent"]))},[(0,n.bo)((0,n.Lk)("input",{class:(0,g.C4)(s.isError.login?"authorization_error":""),"onUpdate:modelValue":t[0]||(t[0]=e=>s.login=e),type:"text",placeholder:s.isRegister?s.placeholderLog:s.placeholderLog+" или "+s.placeholderEmail,required:""},null,10,Q),[[r.Jo,s.login]]),s.isRegister?(0,n.bo)(((0,n.uX)(),(0,n.CE)("input",{key:0,class:(0,g.C4)(s.isError.email?"authorization_error":""),"onUpdate:modelValue":t[1]||(t[1]=e=>s.email=e),type:"email",placeholder:s.placeholderEmail,required:""},null,10,V)),[[r.Jo,s.email]]):(0,n.Q3)("",!0),(0,n.bo)((0,n.Lk)("input",{class:(0,g.C4)(s.isError.password?"authorization_error":""),"onUpdate:modelValue":t[2]||(t[2]=e=>s.password=e),type:"password",placeholder:s.placeholderPass,required:""},null,10,U),[[r.Jo,s.password]]),s.isRegister?(0,n.bo)(((0,n.uX)(),(0,n.CE)("input",{key:1,class:(0,g.C4)(s.isError.confirmPassword?"authorization_error":""),"onUpdate:modelValue":t[3]||(t[3]=e=>s.confirmPassword=e),type:"password",placeholder:s.placeholderConfPass,required:""},null,10,J)),[[r.Jo,s.confirmPassword]]):(0,n.Q3)("",!0),(0,n.Lk)("button",W,(0,g.v_)(s.isRegister?"Создать аккаунт":"Войти"),1),(0,n.Lk)("button",{type:"button",class:"authorization_button",onClick:t[4]||(t[4]=e=>a.toggleChange()),ref:"register"},(0,g.v_)(s.isRegister?"Войти":"Создать аккаунт"),513)],32)])}var z={data(){return{isAuthenticated:!1,role:null,isRegister:!1,title:!0,login:"",email:"",password:"",confirmPassword:"",placeholderEmail:"Email",placeholderLog:"Логин",placeholderPass:"Пароль не менее 6 символов",placeholderConfPass:"Повторите пароль",isError:{login:!1,email:!1,password:!1,confirmPassword:!1},fetchDataResponse:!1,DataResponseText:""}},computed:{...(0,d.aH)(["isAuthenticated","role"])},methods:{...(0,d.i0)(["setAuthenticated","setRole"]),setAuthenticated(e){this.isAuthenticated=e,localStorage.setItem("isAuthenticated",e)},setRole(e){this.role=e,localStorage.setItem("userRole",e)},toggleChange(){this.isRegister=!this.isRegister},validateForm(){this.resetErrors();let e=!0;return""===this.login&&(this.placeholderLog="Логин не может быть пустым",this.isError.login=!0,e=!1,this.login=""),this.password.length<6&&(this.placeholderPass="Пароль должен содержать не менее 6 символов",this.isError.password=!0,e=!1,this.password=""),this.isRegister&&this.password!==this.confirmPassword&&(this.placeholderConfPass="Пароли не совпадают",this.isError.confirmPassword=!0,e=!1,this.confirmPassword=""),this.isRegister&&!this.email?(this.placeholderEmail="Email не может быть пустым",this.isError.email=!0,e=!1,this.email=""):this.isRegister&&!/\S+@\S+\.\S+/.test(this.email)&&(this.placeholderEmail="Неверный формат email",this.isError.email=!0,e=!1,this.email=""),e},resetErrors(){this.isError.login=!1,this.isError.email=!1,this.isError.password=!1,this.isError.confirmPassword=!1},handleSubmit(){this.validateForm()&&this.fetchData(this.isRegister?"register":"login")},fetchData(e){const t={method:"POST",headers:{"Content-Type":"application/json"}};t.body=JSON.stringify({username:this.login,email:this.email,password:this.password}),fetch(`http://localhost:3000/${e}`,t).then((e=>e.headers.get("Content-Type")?.includes("application/json")?e.json():e.text())).then((e=>{this.password="",this.login="",this.fetchDataResponse=!0,this.DataResponseText=e.error,e.success&&(this.setAuthenticated(!0),this.setRole(e.role),this.$router.push("./menu").then((()=>{window.location.reload()})))})).catch((e=>console.error("ОШИБКА",e)))}},mounted(){this.$store.commit("initializeStore")}};const H=(0,m.A)(z,[["render",q]]);var K=H,G={__name:"UserAuthorizationView",setup(e){return(e,t)=>((0,n.uX)(),(0,n.CE)("main",null,[(0,n.bF)(K)]))}};const Y=G;var Z=Y;const ee=e=>((0,n.Qi)("data-v-6c492beb"),e=e(),(0,n.jt)(),e),te={class:"home"},ie=ee((()=>(0,n.Lk)("h1",null,"Добро пожаловать на наш сайт!",-1))),re=ee((()=>(0,n.Lk)("p",null,"Здесь вы можете найти лучшие товары по выгодным ценам.",-1)));function ne(e,t){const i=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",te,[(0,n.Lk)("header",null,[ie,re,(0,n.bF)(i,{to:"/catalog",class:"button"},{default:(0,n.k6)((()=>[(0,n.eW)("Перейти в каталог")])),_:1})])])}const oe={},se=(0,m.A)(oe,[["render",ne],["__scopeId","data-v-6c492beb"]]);var ae=se,le={__name:"IndexView",setup(e){return(e,t)=>((0,n.uX)(),(0,n.CE)("main",null,[(0,n.bF)(ae)]))}};const ue=le;var ce=ue;const de=e=>((0,n.Qi)("data-v-bdcc3d06"),e=e(),(0,n.jt)(),e),he={class:"catalog"},me=de((()=>(0,n.Lk)("h2",null,"Каталог товаров",-1))),pe={class:"products"};function be(e,t,i,r,o,s){const a=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",he,[me,(0,n.Lk)("div",pe,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.products,(e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"product"},[(0,n.Lk)("h3",null,(0,g.v_)(e.name),1),(0,n.Lk)("p",null,"Цена: "+(0,g.v_)(e.price)+"₽",1),(0,n.bF)(a,{to:s.productLink(e),class:"button"},{default:(0,n.k6)((()=>[(0,n.eW)("Посмотреть")])),_:2},1032,["to"])])))),128))])])}var ge={data(){return{separator:"/",products:[{id:1,name:"Товар 1",price:100},{id:2,name:"Товар 2",price:200},{id:3,name:"Товар 3",price:300},{id:4,name:"Товар 4",price:400}]}},computed:{currentPath(){return this.$route.path},breadcrumbPaths(){return this.currentPath.split("/").filter((e=>e))}},methods:{productLink(e){return`${this.currentPath}/${e.name}/${e.price}/id=${e.id}`}}};const ve=(0,m.A)(ge,[["render",be],["__scopeId","data-v-bdcc3d06"]]);var fe=ve,Ee={__name:"CatalogView",setup(e){return(e,t)=>((0,n.uX)(),(0,n.CE)("main",null,[(0,n.bF)(fe)]))}};const ke=Ee;var _e=ke;const Ae=e=>((0,n.Qi)("data-v-24addbed"),e=e(),(0,n.jt)(),e),Ce={class:"product-page"},we=Ae((()=>(0,n.Lk)("p",null,"Описание?",-1)));function Ie(e,t,i,r,o,s){const a=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",Ce,[(0,n.Lk)("h1",null,(0,g.v_)(o.name),1),(0,n.Lk)("p",null,"Цена: "+(0,g.v_)(o.price)+" ₽",1),we,(0,n.bF)(a,{to:"/catalog",class:"button"},{default:(0,n.k6)((()=>[(0,n.eW)("Назад к каталогу")])),_:1})])}var Te={data(){return{product:null,id:this.$route.params.productId,name:this.$route.params.productName,price:this.$route.params.productPrice}}};const ye=(0,m.A)(Te,[["render",Ie],["__scopeId","data-v-24addbed"]]);var Pe=ye,Le={__name:"ProductView",setup(e){return(e,t)=>((0,n.uX)(),(0,n.CE)("main",null,[(0,n.bF)(Pe)]))}};const Re=Le;var Me=Re;const Se=[{path:"/menu",component:x},{path:"/login",component:Z},{path:"/home",component:ce},{path:"/catalog",component:_e},{path:"/catalog/:productName/:productPrice?/:productId?",component:Me}],Xe=(0,c.aE)({history:(0,c.LA)(),routes:Se});var Fe=Xe,$e=(0,d.y$)({state(){return{isAuthenticated:JSON.parse(localStorage.getItem("isAuthenticated"))||!1,isRole:localStorage.getItem("userRole")||null}},mutations:{SET_AUTHENTICATED(e,t){e.isAuthenticated=t,localStorage.setItem("isAuthenticated",JSON.stringify(t))},SET_ROLE(e,t){e.isRole=t,localStorage.setItem("userRole",t)}},actions:{setAuthenticated({commit:e},t){e("SET_AUTHENTICATED",t)},setRole({commit:e},t){e("SET_ROLE",t)}},getters:{isAuthenticated:e=>e.isAuthenticated,currentRole:e=>e.isRole}});(0,r.Ef)(b).use(Fe).use($e).mount("#app")}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,i),o.exports}i.m=e,function(){var e=[];i.O=function(t,r,n,o){if(!r){var s=1/0;for(c=0;c<e.length;c++){r=e[c][0],n=e[c][1],o=e[c][2];for(var a=!0,l=0;l<r.length;l++)(!1&o||s>=o)&&Object.keys(i.O).every((function(e){return i.O[e](r[l])}))?r.splice(l--,1):(a=!1,o<s&&(s=o));if(a){e.splice(c--,1);var u=n();void 0!==u&&(t=u)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[r,n,o]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};i.O.j=function(t){return 0===e[t]};var t=function(t,r){var n,o,s=r[0],a=r[1],l=r[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);if(l)var c=l(i)}for(t&&t(r);u<s.length;u++)o=s[u],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(c)},r=self["webpackChunkvue_menu_editor"]=self["webpackChunkvue_menu_editor"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=i.O(void 0,[504],(function(){return i(8957)}));r=i.O(r)})();
//# sourceMappingURL=app.a3518fdc.js.map